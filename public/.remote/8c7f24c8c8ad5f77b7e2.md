---
title: あなたの現場のGoのフォーマット環境整備屋さん 3.最終話lefthookで自動フォーマットの巻
tags:
  - Go
  - GitHub
  - CI
  - Format
  - Lefthook
private: false
updated_at: '2026-02-23T17:49:29+09:00'
id: 8c7f24c8c8ad5f77b7e2
organization_url_name: null
slide: false
ignorePublish: false
---
こんちくわー、お元気でしょうか〜

はい、あなたの現場のフォーマット屋さん最終章ですねぇ

lefthookの設定をやっていきましょう！！

## 今回やること
lefthookを設定し、Goファイルコミット時に自動でフォーマットされるようにしましょう！

## lefthookとは？
lefthookはGitのhook設定を管理するツールです!!

Hook（フック）とは、特定のタイミングで自動的に実行される処理のことです。

Gitには様々な「イベント」があります：
- コミット前
- コミットメッセージ確定前
- プッシュ前
- マージ後 など

これらのタイミングで任意のスクリプトを実行できる仕組みが Git Hook です。

今回はコミット時にプログラムを作動させて、フォーマットコマンドが実行できればと思います！

## lefthook設定方法
次にlefthook設定をしていきましょう!!

### lefthook設定ファイル作成
まず、lefthookを管理するファイルを作成します！

```bash
cd リポジトリのルート
touch lefthook.yml
```

下記のようにlefthook.ymlに書き込んでください！
```yaml
pre-commit:
  commands:
    fmt:
      glob: "*.go"
      run: gofmt -s -w {staged_files} && git add {staged_files}
```

### lefthook設定ファイル内容の説明
```
pre-commit:
```
これは Git の pre-commit フック を指定しています。
git commit を実行した直前に、この処理を実行し、
コミットが確定する前にチェックや整形を行うタイミングの指定をしています

```
commands:
```
ここに、実行したい処理を定義します。
複数書くことも可能ですが、今回は fmt 1つだけです。

```
fmt:
```
これは 任意のラベル名 です。
実行ログに表示される名前
好きな名前でOK!!

```
glob: "*.go"
```
これは 実行対象ファイルのフィルタ です。
ステージされている .go ファイルがある場合のみ、このコマンドを実行する

```
{staged_files}
```
これは Lefthook のプレースホルダです。
現在 git add 済みのファイル一覧
例えば：
git add main.go handler/user.go
している場合、内部では：
```bash
gofmt -s -w main.go handler/user.go
```
のように展開されます。

```bash
gofmt -s -w {staged_files}

```
それぞれの意味：
| オプション | 意味 |
|------------|------|
| `-s` | simplify（冗長コードの簡略化） |
| `-w` | ファイルへ直接書き込み |

コード整形をstagiしたGoファイルに対して実行します。

```bash
&& git add {staged_files}
```
フォーマット後の状態
gofmt がファイルを書き換える
しかし Git のステージは古いまま
そのままだと整形前のコードがコミットされる
そのため、整形後に再度 git add する必要がある

### lefthookで定義した内容をinstallする
```bash
lefthook install
```
これを実行すると：
.git/hooks/
の中に Lefthook のフックスクリプトが生成されます。
つまり：
Git のフックを Lefthook 経由で実行するように差し替える
という処理です。

## 動作検証
とりあえず、lefthook作成と、定義までちゃちゃっとやりました。
```bash
$ ls lefthook.yml
lefthook.yml
```

動作確認検証ファイル作成してください！
```bash
$ touch main.go
# (オプションです笑 $_で前のコマンドで実行した最後引数が入るんですよ！という謎ナレッジ)
# viなどで編集する
$ vi $_
```

下記のようにmain.goを編集してください

```go
package main
import "fmt"
func main(){
if x := true; x == true{
fmt.Println("Hello")
}
}
```

lefthook install を実行!
```bash
$ lefthook install
sync hooks: ✔️ (pre-commit)
```

では、実際にpre-commitでlefthookが正常に動作するか確認しましょう。
こちらのコマンドで手動でlefthookを作動させることが可能です！
```bash
$ lefthook run pre-commit
╭──────────────────────────────────────╮
│ 🥊 lefthook v2.1.1  hook: pre-commit │
╰──────────────────────────────────────╯
┃  fmt ❯



  ────────────────────────────────────
summary: (done in 0.08 seconds)
✔️ fmt (0.02 seconds)
```

うごきました！ではmain.goの方は..？
お！ちゃんとフォーマットされていますね！成功です！
```go
package main

import "fmt"

func main() {
	if x := true; x == true {
		fmt.Println("Hello")
	}
}

```

## おわり

私はいくつの現場にこのCIとlefthookを導入したことか（遠い目）

みなさんが現場にフォーマット環境を整備することがきっといつかはあるはずです!!

その時はぜひこのアイディアを思い出してください！

次のフォーマット王はあなただ！

ありったけの〜夢を〜かき集め〜（ワンピースOP）

探せ！この世のすべてをそこにおいてきた！

おわり
