---
title: ã‚ãªãŸã®ç¾å ´ã®Goã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆç’°å¢ƒæ•´å‚™å±‹ã•ã‚“ 2.CIã§ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãƒã‚§ãƒƒã‚¯ã®å·»
tags:
  - Go
  - GitHub
  - CI
  - Format
private: false
updated_at: '2026-02-21T21:17:59+09:00'
id: 41ffb6a947dc14e107b0
organization_url_name: null
slide: false
ignorePublish: false
---
ã©ã‚‚ãƒ¼ã“ã‚“ã¡ãã‚

ãƒ«ãƒã‚¢ãƒ¼ãƒ«ã§åŸ·ç­†ä½œæ¥­ä¸­ã§ã™ãƒ¼

ãƒ«ãƒã‚¢ãƒ¼ãƒ«ã™ã”ã„æ¤…å­ãŒãƒ•ã‚«ãƒ•ã‚«ã§å¥½ããªã‚“ã§ã™ã‚ˆã­ğŸ˜Š

è½ã¡ç€ã„ãŸé›°å›²æ°—ã‚‚å¥½ãã§ã™ï¼

ã•ã¦ä»Šå›ã¯ã€ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆç’°å¢ƒæ•´å‚™ç¬¬äºŒå¼¾ï¼CIã®å®Ÿè£…ã§ã™ï¼

## ä»Šå›å®Ÿè£…ã™ã‚‹ã®ã¯CIã¯ã©ã‚“ãªå†…å®¹ã‹

GitHubã«PRä½œæˆã¾ãŸã¯ã‚³ãƒŸãƒƒãƒˆã—ãŸã¨ãã«ã€CIã‚’å‹•ä½œã•ã›ã¾ã™ã€‚

ãã“ã§ã€ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãƒã‚§ãƒƒã‚¯ã‚’ã—ã¾ã™ã€‚

ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãŒæ•´å‚™ã•ã‚Œã¦ã„ãªã‹ã£ãŸå ´åˆã¯ã€CIã‚¨ãƒ©ãƒ¼ã¨åˆ¤æ–­ã—ã¾ã™ã€‚

ãã‚“ãªå†…å®¹ã«ãªã£ã¦ã„ã¾ã™ï¼

## CIã®å†…å®¹ã‚’å®šç¾©ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œã‚ã†

ã¾ãšã¯ä¸‹è¨˜ã‚³ãƒãƒ³ãƒ‰ã§CIã«æŒ‡ç¤ºã‚’å‡ºã™ymlãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã—ã‚‡ã†ï¼

```bash
# ãƒ•ã‚©ãƒ«ãƒ€ä½œæˆ
mkdir -p .github/workflows
# ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ
touch .github/workflows/format.yml
```


ä½œæˆã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã«ã“ã®ã‚ˆã†ã«æ›¸ã„ã¦ãã ã•ã„ï¼

```yaml
name: gofmt

on:
  pull_request:
  push:
    branches: [ main ]

jobs:
  gofmt:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - uses: actions/setup-go@v5
        with:
          go-version-file: go.mod
          cache: true

      - name: gofmt -s check
        shell: bash
        run: |
          set -euo pipefail
          # -w ã¯ã—ãªã„ï¼ˆCIã§ã¯â€œå·®åˆ†ãŒå‡ºãŸã‚‰è½ã¨ã™â€ï¼‰
          files="$(gofmt -l -s .)"
          if [ -n "$files" ]; then
            echo "These files are not gofmt -s formatted:"
            echo "$files"
            echo
            echo "Run: gofmt -w -s ."
            exit 1
          fi
```

### CIãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹èª¬æ˜

```
runs-on: ubuntu-latest
```
GitHubãŒç”¨æ„ã—ã¦ã„ã‚‹Ubuntuã®ä»®æƒ³ç’°å¢ƒã§å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚

```
- uses: actions/checkout@v4
```
ãƒªãƒã‚¸ãƒˆãƒªã®ã‚³ãƒ¼ãƒ‰ã‚’CIç’°å¢ƒã«ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆã—ã¾ã™ã€‚
ã“ã‚ŒãŒãªã„ã¨ã€CIç’°å¢ƒã«ã¯ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ãŒå­˜åœ¨ã—ã¾ã›ã‚“ã€‚

```
- uses: actions/setup-go@v5
  with:
    go-version-file: go.mod
    cache: true
```
go.mod ã«è¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹Goãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’åˆ©ç”¨
ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’æœ‰åŠ¹ã«ã—ã¦é«˜é€ŸåŒ–
ã“ã‚Œã§ gofmt ã‚³ãƒãƒ³ãƒ‰ãŒä½¿ç”¨å¯èƒ½ã«ãªã‚Šã¾ã™ã€‚

```bash
set -euo pipefail
```
Bashã®ä¸­æ–­è¨­å®š
-e : ã‚¨ãƒ©ãƒ¼ãŒå‡ºãŸã‚‰å³çµ‚äº†
-u : æœªå®šç¾©å¤‰æ•°ã‚’ã‚¨ãƒ©ãƒ¼æ‰±ã„
pipefail : ãƒ‘ã‚¤ãƒ—å‡¦ç†å†…ã®å¤±æ•—ã‚‚æ¤œçŸ¥
CIã§ã¯ã»ã¼å¿…é ˆã®è¨­å®šã§ã™ã€‚

```bash
files="$(gofmt -l -s .)"
```

**å·®åˆ†ãƒ•ã‚¡ã‚¤ãƒ«ã®å–å¾—**
- -l : æ•´å½¢ãŒå¿…è¦ãªãƒ•ã‚¡ã‚¤ãƒ«åã‚’å‡ºåŠ›
- -s : simplifyï¼ˆç°¡ç•¥åŒ–ã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
- . : ãƒªãƒã‚¸ãƒˆãƒªå…¨ä½“ã‚’å¯¾è±¡
ã¤ã¾ã‚Šã€
ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã•ã‚Œã¦ã„ãªã„ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§ã‚’å–å¾—
ã—ã¦ã„ã¾ã™ã€‚

```bash
if [ -n "$files" ]; then
```
$files ãŒç©ºã§ãªã‘ã‚Œã°ã€
= ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãŒå´©ã‚Œã¦ã„ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã™ã‚‹
ã¨ã„ã†æ„å‘³ã§ã™ã€‚

```bash
echo "These files are not gofmt -s formatted:"
echo "$files"
echo
echo "Run: gofmt -w -s ."
exit 1
```
CIã‚’å¤±æ•—ã•ã›ã‚‹
æ•´å½¢ãŒå¿…è¦ãªãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¡¨ç¤º
ä¿®æ­£ã‚³ãƒãƒ³ãƒ‰ã‚’è¡¨ç¤º
exit 1 ã§ã‚¸ãƒ§ãƒ–ã‚’å¤±æ•—ã•ã›ã‚‹
ã“ã‚Œã«ã‚ˆã‚Šã€ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãŒå´©ã‚Œã¦ã„ã‚‹ã‚³ãƒ¼ãƒ‰ã¯ãƒãƒ¼ã‚¸ã§ããªã„ä»•çµ„ã¿ã«ãªã‚Šã¾ã™ã€‚

## å‹•ä½œç¢ºèªã—ã¦ã¿ã‚ˆã†ï¼

CIãƒ•ã‚©ãƒ«ãƒ€ã€ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ
```bash
$ mkdir -p .github/workflows
$ touch .github/workflows/format.yml
# ã§ãŠå¥½ã¿ã®ã‚¨ãƒ‡ã‚£ã‚¿ã§é©å½“ã«CIè¨­å®šã‚’è¨˜è¼‰
```

ãã†ã„ãˆã°PRä½œæˆç”¨ãƒ–ãƒ©ãƒ³ãƒã‚’ä½œã£ã¦ã„ãªã‹ã£ãŸã®ã§ä½œæˆ
```bash
$ git checkout -b test/gofmt
Switched to a new branch 'test/gofmt'
$ git push -u origin test/gofmt
Total 0 (delta 0), reused 0 (delta 0), pack-reused 0
remote:
remote: Create a pull request for 'test/gofmt' on GitHub by visiting:
remote:      https://github.com/KM-rira/gofmt-ci/pull/new/test/gofmt
remote:
To github.com:KM-rira/gofmt-ci.git
 * [new branch]      test/gofmt -> test/gofmt
branch 'test/gofmt' set up to track 'origin/test/gofmt'.
```

go.modã‚‚ä½œæˆã™ã‚‹(ä»Šã®çŠ¶æ…‹ã ã¨ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ãŸã‚)
```bash
$ go mod init gofmt-ci
go: creating new go.mod: module gofmt-ci
go: to add module requirements and sums:
        go mod tidy
$ go mod tidy
```

ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãŒã§ãã¦ã„ãªã„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã™ã‚‹
```bash
$ touch main.go
```

(ç§ã®æ„›ã—ã®Neovimã‚¨ãƒ‡ã‚£ã‚¿ã¯ä¿å­˜æ™‚ã«å‹æ‰‹ã«ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã™ã‚‹è¨­å®šã¨ãªã£ã¦ã„ã‚‹ã®ã§ã€viã§ç·¨é›†)
```go
package main

import "fmt"

func main() {
	arr := []int{1, 2, 3}

	// -s(simplify) ã§ç°¡ç•¥åŒ–ã•ã‚Œã‚‹ï¼ˆ0:len(arr) â†’ :ï¼‰
	s := arr[0:len(arr)]
	fmt.Println(s)

	// -s ã§ç°¡ç•¥åŒ–ã•ã‚Œã‚‹ï¼ˆint(1) â†’ 1 ãªã©ï¼‰
	x := []int{int(1), int(2), int(3)}
	fmt.Println(x)

	// ã“ã‚Œã¯é€šå¸¸ã® gofmt ã§ã‚‚æ•´å½¢ã•ã‚Œã‚‹ï¼ˆã‚¹ãƒšãƒ¼ã‚¹ãªã©ï¼‰
	y  :=  1
	fmt.Println(y)
}

```

ã“ã®ã‚ˆã†ã«ãªã‚Œã°OK
```bash
# ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã•ã‚Œã¦ã„ãªã„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‡ºåŠ›ã™ã‚‹
$ gofmt -l -s .
main.go
```

ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ã€ã‚³ãƒŸãƒƒãƒˆã€ãƒ—ãƒƒã‚·ãƒ¥ï¼(é›‘)
```bash
$ git add main.go
$ git commit -m "test commit"
[test/gofmt 920de89] test commit
 1 file changed, 19 insertions(+)
 create mode 100644 main.go
$ git push
Enumerating objects: 4, done.
Counting objects: 100% (4/4), done.
Delta compression using up to 16 threads
Compressing objects: 100% (3/3), done.
Writing objects: 100% (3/3), 536 bytes | 536.00 KiB/s, done.
Total 3 (delta 0), reused 0 (delta 0), pack-reused 0
To github.com:KM-rira/gofmt-ci.git
   6154612..920de89  test/gofmt -> test/gofmt
```

ãŠï¼å‹•ã„ã¦ã‚‹ï¼
![Screenshot from 2026-02-21 20-49-44.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/3830923/8c9ed0f2-bdce-4a5c-ae24-3cd3f477cb16.png)

ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã•ã‚Œã¦ã„ãªã„ãŸã‚ã€æœŸå¾…é€šã‚ŠNGï¼ï¼
![Screenshot from 2026-02-21 20-48-48.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/3830923/3fd8c640-87ef-4227-9e54-a678cae334d4.png)

ã§ã¯ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã—ã¾ã—ã‚‡ã†ï¼
```bash
$ gofmt -w -s .
```

å†åº¦ã‚³ãƒŸãƒƒãƒˆãƒ—ãƒƒã‚·ãƒ¥
```bash
$ git add main.go
$ git commit -m "gofmt -w -s"
$ git push
```

çµæœã¯ï¼Ÿ
![Screenshot from 2026-02-21 20-52-50.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/3830923/57768f1d-ace3-4626-a194-d542e7cb096b.png)

OK!!ã“ã‚Œã§å®‰å…¨ãªGoã®æ˜ã‚‹ã„ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæœªæ¥ã¯ä¿è¨¼ã•ã‚ŒãŸï¼ï¼

ã¿ã‚“ãªã‚‚å°å…¥ã—ã¦ã¿ã¦ã­âœ¨

ã§ã¯ã§ã¯~
